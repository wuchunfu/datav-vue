import{b as P,H as B,F as f,E as c,$ as j}from"./App.2074c692.js";import{I as z}from"./warning.4e8a34dc.js";import{I as G}from"./document.007a4987.js";import{F as H}from"./filter-collapse-panel.91669658.js";import{a3 as L,b2 as O,bg as U,a8 as M,aB as N,aG as I,bk as v,a4 as l,a6 as y,b3 as p,ba as W,a5 as F,aZ as m,ac as h,ag as $,a9 as T,ae as Z,ad as q,b4 as V}from"./vendor.60e09344.js";import"./arrow-left.1ade43d2.js";import"./edit.bc80ca49.js";import"./delete.490b613d.js";import"./release.d11cb5a8.js";const x=L({name:"FilterManagerDrawer",components:{IconDocument:G,FilterCollapsePanel:H},setup(){const n=O(),u=U(),_=M(!1),d=M(null);N(()=>B.filter.show,e=>{_.value=e}),N(_,e=>{e||(B.filter.show=!1)});const A=I(()=>f.dataFilters),b=I(()=>{const e=[...c.coms,...c.subComs],t=Object.create(null);return e.forEach(a=>{for(const s in a.apiData)a.apiData[s].pageFilters.forEach(o=>{t[o.id]?(t[o.id].ids.push(a.id),t[o.id].names.push(a.alias)):t[o.id]={ids:[a.id],names:[a.alias]}})}),t}),D=()=>{d.value||(d.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},C=(e,t)=>{const a=e.trim();a&&t.name!==a&&(t.name=a,t.id>0&&f.updateFilterName(t))},E=e=>{if(e>0){const t=u.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>W(z),onPositiveClick:async()=>{t.loading=!0;try{await f.deleteFilter(e);const a=b.value[e];a&&[...c.coms,...c.subComs].filter(r=>a.ids.includes(r.id)).forEach(r=>{for(const o in r.apiData){const i=r.apiData[o],w=i.pageFilters.find(k=>k.id===e);i.pageFilters=i.pageFilters.filter(k=>k.id!==e),w&&w.enabled&&j(r.id,o,r.apis[o],i)}})}catch(a){n.error(a.message)}}})}else d.value=null},g=async e=>{if(e.id>0){await f.updateFilter(e);const t=b.value[e.id];t&&[...c.coms,...c.subComs].filter(s=>t.ids.includes(s.id)).forEach(s=>{for(const r in s.apiData){const o=s.apiData[r],i=o.pageFilters.find(w=>w.id===e.id);i&&i.enabled&&j(s.id,r,s.apis[r],o)}})}else await f.createFilter(e),d.value=null};return v("usedFilters",b),v("editFilterName",C),v("removeFilter",E),v("saveFilter",g),{visible:_,dataFilters:A,newDataFilter:d,addFilter:D,removeFilter:E}}}),J={class:"filter-manager-title"},K=V(" \u6570\u636E\u8FC7\u6EE4\u5668"),Q=h("span",null,"\u5E2E\u52A9\u6587\u6863",-1),R={key:1,class:"panel-info"},S=h("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),X=V(" \u65B0\u5EFA ");function Y(n,u,_,d,A,b){const D=l("IconDocument"),C=l("n-icon"),E=l("router-link"),g=l("filter-collapse-panel"),e=l("n-button"),t=l("n-drawer-content"),a=l("n-drawer");return F(),y(a,{show:n.visible,"onUpdate:show":u[1]||(u[1]=s=>n.visible=s),width:"500px",placement:"left",class:"filter-manager-drawer",to:"#edit-main-wp"},{default:p(()=>[m(t,{closable:""},{header:p(()=>[h("p",J,[K,h("span",{class:"create-filter",onClick:u[0]||(u[0]=(...s)=>n.addFilter&&n.addFilter(...s))},"\u65B0\u5EFA"),m(E,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p(()=>[m(C,{size:12},{default:p(()=>[m(D)]),_:1}),Q]),_:1})])]),default:p(()=>[n.newDataFilter?(F(),y(g,{key:0,"data-filter":n.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):$("",!0),(F(!0),T(q,null,Z(n.dataFilters,s=>(F(),y(g,{key:s.id,"data-filter":s,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),n.dataFilters.length===0&&!n.newDataFilter?(F(),T("div",R,[S,m(e,{focusable:!1,onClick:n.addFilter},{default:p(()=>[X]),_:1},8,["onClick"])])):$("",!0)]),_:1})]),_:1},8,["show"])}var ue=P(x,[["render",Y]]);export{ue as default};
