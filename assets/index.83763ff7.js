var re=Object.defineProperty;var Z=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var V=(e,t,n)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))ce.call(t,n)&&V(e,n,t[n]);if(Z)for(var n of Z(t))de.call(t,n)&&V(e,n,t[n]);return e};var $=(e,t,n)=>(V(e,typeof t!="symbol"?t+"":t,n),n);import{a5 as w,a9 as M,ac as f,a3 as E,aG as v,ab as m,ag as N,a8 as S,aI as ue,ai as he,aC as fe,a4 as R,aZ as O,b3 as U,a6 as I,af as J,aa as B,ah as me,ad as j,ae as K,aR as D,aD as ve,be as Q,bf as P,n as ge,bn as ye}from"./vendor.60e09344.js";import{b as k,E as p,H as Y,B as pe}from"./App.2074c692.js";import{c as we}from"./index.3cb2e44c.js";import{a as X,o as L,b}from"./dom.cd0136fc.js";import{u as xe}from"./index.5c42d530.js";import"./templates.d393430b.js";const $e={},Me={t:"1639130833808",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3985",width:"64",height:"64"},Le=f("path",{d:"M341.33333333 579.33333333C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c85.336 0 170.664 58 256 174C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-85.336 0-170.664-48.664-256-146z m96-5.6C490.66933333 632.13333333 543.99733333 661.33333333 597.33333333 661.33333333s106.664-29.2 160-87.6C703.99733333 504.13333333 650.66933333 469.33333333 597.33333333 469.33333333s-106.664 34.8-160 104.4zM597.33333333 629.33333333a64 64 0 1 1 0-128 64 64 0 0 1 0 128zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"3986"},null,-1),be=[Le];function _e(e,t){return w(),M("svg",Me,be)}var Ce=k($e,[["render",_e]]);const Se={},Re={t:"1639130872871",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4135",width:"64",height:"64"},ke=f("path",{d:"M651.14133333 413.01333333l-56.344 56.344C542.30933333 470.45333333 489.82133333 505.23733333 437.33333333 573.73333333a416 416 0 0 0 26.48 26.6l-49.976 49.984c-24.168-19.76-48.336-43.416-72.504-70.984C426.66933333 463.33333333 511.99733333 405.33333333 597.33333333 405.33333333c17.936 0 35.872 2.56 53.808 7.68z m113.968 67.056c29.408 26.2 58.816 59.28 88.224 99.264C767.99733333 676.66933333 682.66933333 725.33333333 597.33333333 725.33333333c-22.456 0-44.92-3.368-67.376-10.112l54.456-54.456c4.304 0.376 8.616 0.568 12.92 0.568 53.336 0 106.664-29.2 160-87.6-13.368-17.44-26.736-32.704-40.112-45.784l47.888-47.88zM213.33333333 213.33333333V85.33333333h64v128h640v64H277.33333333v640h-64V277.33333333H85.33333333v-64h128z","p-id":"4136"},null,-1),ze=f("path",{d:"M770.34933333 339.06133333l45.256 45.256-407.288 407.288-45.256-45.256z","p-id":"4137"},null,-1),Te=[ke,ze];function Ee(e,t){return w(),M("svg",Re,Te)}var Ie=k(Se,[["render",Ee]]);const Be=E({name:"AlignLine",setup(){const e=v(()=>p.alignLine),t=v(()=>p.canvas);return{alignLine:e,canvas:t}}}),De={key:0,class:"ident-line-wp"};function Xe(e,t,n,s,o,a){return e.alignLine.enable&&e.alignLine.show?(w(),M("div",De,[f("div",{class:"ident-line x-line",style:m({width:`${e.canvas.width}px`,top:`${e.alignLine.top}px`})},null,4),f("div",{class:"ident-line x-line",style:m({width:`${e.canvas.width}px`,top:`${e.alignLine.horizontal}px`})},null,4),f("div",{class:"ident-line x-line",style:m({width:`${e.canvas.width}px`,top:`${e.alignLine.bottom}px`})},null,4),f("div",{class:"ident-line y-line",style:m({height:`${e.canvas.height}px`,left:`${e.alignLine.left}px`})},null,4),f("div",{class:"ident-line y-line",style:m({height:`${e.canvas.height}px`,left:`${e.alignLine.vertical}px`})},null,4),f("div",{class:"ident-line y-line",style:m({height:`${e.canvas.height}px`,left:`${e.alignLine.right}px`})},null,4)])):N("",!0)}var Ge=k(Be,[["render",Xe],["__scopeId","data-v-1cdaa634"]]);const G=e=>`${e}px`,ee=(e,t,n,s)=>{const o=e!=null?e:document.createElement("canvas");o.width=t*s,o.height=n*s,o.style.width=G(t),o.style.height=G(n);const a=o.getContext("2d");return a&&a.setTransform(s,0,0,s,0,0),o},te=(e,t,n,s)=>{var d,u;const o=parseFloat(e.style.transform.match(/(?<=X\()(.+)/ig)[0]),{height:a,scale:l,offset:r}=t;let i=0;return t.direction=="TB"?i=n-(((d=e.parentElement)==null?void 0:d.offsetLeft)||0)-o:i=s-(((u=e.parentElement)==null?void 0:u.offsetTop)||0)-o,i=i-a+t.indicatorLineWidth,{coor:Math.floor((i-r)/l),dist:i}},We=(e,t)=>{const{scale:n,offset:s}=t;return{coor:e,dist:parseFloat((e*n+s).toFixed(3))}},F=class{constructor(t,n,s,o=0){$(this,"guideLine");$(this,"coor",-1);this.el=t,this.options=n,this.constructGuide(s,o)}constructGuide(t,n){const{el:s}=this,o=document.createElement("div");o.title="\u53CC\u51FB\u5220\u9664\u53C2\u8003\u7EBF",X(o,"ruler-line"),this.guideLine=o;const{coor:a}=this;this.setLine(t,n),t&&this.coorChange("add",this.coor,a);let l=s.querySelector(".lines-wrapper");l||(l=document.createElement("div"),X(l,"lines-wrapper"),s.appendChild(l)),l.appendChild(o),L(o,"mousedown",this.moving.bind(this)),L(o,"dblclick",this.dblclick.bind(this))}moving(t){F.isMoveing=!0;const{options:n}=this;t.preventDefault(),t.stopPropagation();const{coor:s}=this,o=l=>{n.direction==="TB"?document.body.style.cursor="ew-resize":document.body.style.cursor="ns-resize",this.setLine(l)},a=()=>{F.isMoveing=!1,document.body.style.cursor="",b(document,"mousemove",o),b(document,"mouseup",a);const{coor:l}=this;l<0?this.coorChange("delete",s,s):this.coorChange("update",l,s)};L(document,"mousemove",o),L(document,"mouseup",a)}setLine(t,n=0){const{el:s,options:o,guideLine:a}=this,l=t?te(s,o,t.clientX,t.clientY):We(n,o);o.direction==="TB"?a.style.left=G(l.dist):a.style.top=G(l.dist),a.innerHTML=`
      <div class="line-action">
        <span class="line-value">${l.coor}</span>
      </div>`,this.coor=l.coor}dblclick(t){t.preventDefault(),t.stopPropagation(),this.destroy()}coorChange(t,n,s){const{options:o}=this;o.coorChange&&o.coorChange(t,n,s)}show(){this.guideLine.style.display="block"}hide(){this.guideLine.style.display="none"}destroy(){const{guideLine:t,coor:n}=this;this.coorChange("delete",n,n),b(t,"mousedown",this.moving.bind(this)),b(t,"dblclick",this.dblclick.bind(this)),t.remove()}};let W=F;$(W,"isMoveing",!1);class ne{constructor(t,n){$(this,"el");$(this,"canvas");$(this,"ctx");$(this,"ruler",{width:0,height:0});$(this,"indicator");$(this,"indicatorValue");$(this,"guideLines",[]);$(this,"options",{direction:"TB",width:1e3,height:20,bgColor:"#0e1013",fontFamily:"sans-serif",fontSize:"10px",fontColor:"#90a0ae",strokeStyle:"rgba(161, 174, 179, 0.8)",lineWidth:.5,indicatorLineWidth:1,scale:1,offset:40,ratio:2});this.el=t,this.options=T(T({},this.options),n),this.constructRuler()}constructRuler(){const{el:t,options:n}=this,{direction:s,width:o,height:a,ratio:l}=n,r=Math.max(s==="TB"?t.offsetWidth:t.offsetHeight,o),i=a;this.ruler.width=r,this.ruler.height=i;const c=ee(null,r,i,l);X(c,"canvas-ruler"),t.appendChild(c),this.canvas=c,this.ctx=c.getContext("2d"),this.drawRuler(),L(c,"mouseenter",this.constructIndicator.bind(this)),L(c,"mousedown",this.createGuideLine.bind(this))}drawRuler(){const{ctx:t,options:n,ruler:s}=this,{width:o,height:a}=s;t.beginPath(),t.fillStyle=n.bgColor,t.fillRect(0,0,o,a),t.closePath(),t.beginPath(),t.font=`${n.fontSize} ${n.fontFamily}`,t.textAlign="left",t.fillStyle=n.fontColor,t.strokeStyle=n.strokeStyle,t.lineWidth=n.lineWidth,this.drawPoints(),t.stroke()}drawPoints(){const{ctx:t,options:n,ruler:s}=this,{width:o,height:a}=s,{offset:l,scale:r}=n,i=0,c=a/1.5,d=a/1.2;for(let u=0;u<=o;u+=1){const y=u-l;if(y<0)continue;let h=-1,g=-1;y%50==0?(h=Math.floor(y/r),g=i):y%25==0?g=c:y%5==0&&(g=d),g>=0&&(t.moveTo(u+.5,a+.5),t.lineTo(u+.5,g),h>-1&&t.fillText(`${h}`,u+2.5,a/1.5))}}constructIndicator(t){if(W.isMoveing)return;const{el:n,options:s,canvas:o}=this,a=document.createElement("div"),l=document.createElement("span");X(a,"ruler-indicator"),X(l,"indicator-value"),a.appendChild(l),this.indicator=a,this.indicatorValue=l,n.appendChild(a);const r=d=>{const u=te(n,s,d.clientX,d.clientY);a.style.left=G(u.dist),l.textContent=`${u.coor}`};r(t);const i=d=>{r(d)},c=()=>{b(o,"mousemove",i),b(o,"mouseout",c),a.remove()};L(o,"mousemove",i),L(o,"mouseout",c)}createGuideLine(t){t.preventDefault(),t.stopPropagation();const{el:n,options:s}=this;this.guideLines.push(new W(n,s,t))}setGuideLines(t){const{el:n,options:s}=this;t.forEach(o=>{this.guideLines.push(new W(n,s,null,o))})}setSize(t,n,s){const{el:o,options:a}=this;a.width=t,a.height=n,a.scale=s;const{direction:l,width:r,height:i,ratio:c}=a,d=Math.max(l==="TB"?o.offsetWidth:o.offsetHeight,r),u=i;this.ruler.width=d,this.ruler.height=u,ee(this.canvas,d,u,c),this.drawRuler(),this.guideLines.forEach(y=>y.setLine(null,y.coor))}setScale(t){this.options.scale=t,this.drawRuler(),this.guideLines.forEach(n=>n.setLine(null,n.coor))}toggleGuide(t){const n=t?"show":"hide";this.guideLines.forEach(s=>s[n]())}clearGuides(){this.guideLines.forEach(t=>t.destroy()),this.guideLines=[]}destroy(){const{el:t,canvas:n}=this;this.clearGuides(),b(n,"mouseenter",this.constructIndicator.bind(this)),b(n,"mousedown",this.createGuideLine.bind(this)),t.remove()}}const Ae=E({name:"Ruler",components:{IconLineShow:Ce,IconLineHide:Ie},setup(){const e=S(null),t=S(null),n=S(null),s=S(null),o=S(!0),a=S(0),l=S(0),r=document.documentElement.clientWidth;ue(()=>{if(e.value&&t.value){const{canvas:d,guideLine:u}=p,y=Math.max(d.width,r);n.value?n.value.setSize(y,20,d.scale):(n.value=new ne(e.value,{direction:"TB",width:y,scale:d.scale,coorChange:(h,g,C)=>{h==="add"?u.h.push(g):h==="update"&&g!==C?(u.h=u.h.filter(_=>_!==C),u.h.push(g)):h==="delete"&&(u.h=u.h.filter(_=>_!==g))}}),n.value.setGuideLines(u.h)),s.value?s.value.setSize(d.height,20,d.scale):(s.value=new ne(t.value,{direction:"LR",width:d.height,scale:d.scale,coorChange:(h,g,C)=>{h==="add"?u.v.push(g):h==="update"&&g!==C?(u.v=u.v.filter(_=>_!==C),u.v.push(g)):h==="delete"&&(u.v=u.v.filter(_=>_!==g))}}),s.value.setGuideLines(u.v))}});const i=()=>{n.value&&s.value&&(o.value=!o.value,n.value.toggleGuide(o.value),s.value.toggleGuide(o.value))},c=d=>{const u=d.target;a.value=u.scrollLeft,l.value=u.scrollTop};return he(()=>{const d=document.getElementById("canvas-wp");d==null||d.addEventListener("scroll",c)}),fe(()=>{const d=document.getElementById("canvas-wp");d==null||d.removeEventListener("scroll",c)}),{visible:o,hRulerWpRef:e,vRulerWpRef:t,toggleGuides:i,vScroll:l,hScroll:a}}}),He={class:"canvas-ruler-wp"};function Ye(e,t,n,s,o,a){const l=R("IconLineShow"),r=R("IconLineHide"),i=R("n-icon");return w(),M("div",He,[f("div",{ref:"hRulerWpRef",class:"ruler-wrapper h-container",style:m(`transform: translateX(-${e.hScroll}px);`)},null,4),f("div",{ref:"vRulerWpRef",class:"ruler-wrapper v-container",style:m(`transform: rotate(90deg) translateX(-${e.vScroll}px);`)},null,4),f("div",{title:"\u5207\u6362\u53C2\u8003\u7EBF",class:"ruler-corner",onClick:t[0]||(t[0]=(...c)=>e.toggleGuides&&e.toggleGuides(...c))},[O(i,null,{default:U(()=>[e.visible?(w(),I(l,{key:0,style:{"z-index":"10"}})):(w(),I(r,{key:1}))]),_:1})])])}var Fe=k(Ae,[["render",Ye]]);const Ve=[{direction:"lt",angle:0},{direction:"t",angle:45},{direction:"rt",angle:90},{direction:"r",angle:135},{direction:"rb",angle:180},{direction:"b",angle:225},{direction:"lb",angle:270},{direction:"l",angle:315}],oe=[{start:338,end:23,cursor:"nwse-resize"},{start:23,end:68,cursor:"ns-resize"},{start:68,end:113,cursor:"nesw-resize"},{start:113,end:158,cursor:"ew-resize"},{start:158,end:203,cursor:"nwse-resize"},{start:203,end:248,cursor:"ns-resize"},{start:248,end:293,cursor:"nesw-resize"},{start:293,end:338,cursor:"ew-resize"}],Oe=e=>{const t=(e+360)%360,n={};let s=-1;return Ve.forEach(o=>{const a=(o.angle+t)%360,l=oe.length,r=0;for(;r<l;){s=(s+1)%l;const i=oe[s];if(a<23||a>=338){n[o.direction]="nwse-resize";break}if(i.start<=a&&a<i.end){n[o.direction]=i.cursor;break}}}),n};function je(e){return e*Math.PI/180}function qe(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}}function A(e,t,n){const s=je(n);return{x:(e.x-t.x)*Math.cos(s)-(e.y-t.y)*Math.sin(s)+t.x,y:(e.x-t.x)*Math.sin(s)+(e.y-t.y)*Math.cos(s)+t.y}}function Ze(e,t,n,s,o,a){const l=qe(n,s),r=A(s,l,-t.deg),i=A(n,l,-t.deg);e[0]==="l"?(a.x=Math.round(i.x/o),a.w=Math.round((r.x-i.x)/o)):e[0]==="r"&&(a.x=Math.round(r.x/o),a.w=Math.round((i.x-r.x)/o)),e[1]==="t"?(a.y=Math.round(i.y/o),a.h=Math.round((r.y-i.y)/o)):e[1]==="b"&&(a.y=Math.round(r.y/o),a.h=Math.round((i.y-r.y)/o))}function Ne(e,t,n,s,o,a,l){const r=A(s,n,-t.deg);if(e==="t"||e==="b"){const i=A({x:n.x,y:r.y},n,t.deg),c=Math.sqrt((i.x-o.x)**2+(i.y-o.y)**2);if(c>0){const d={x:i.x-(i.x-o.x)/2,y:i.y+(o.y-i.y)/2};l.h=Math.round(c/a),l.x=Math.round(d.x/a-t.w/2),l.y=Math.round((d.y-c/2)/a)}}if(e==="l"||e==="r"){const i=A({x:r.x,y:n.y},n,t.deg),c=Math.sqrt((i.x-o.x)**2+(i.y-o.y)**2);if(c>0){const d={x:i.x-(i.x-o.x)/2,y:i.y+(o.y-i.y)/2};l.w=Math.round(c/a),l.x=Math.round((d.x-c/2)/a),l.y=Math.round(d.y/a-t.h/2)}}}function Ue(e,t,n,s,o,a){e==="t"?(a.h=Math.round(t.h+(n.y-s.y)/o),a.y=Math.round(t.y+(s.y-n.y)/o)):e==="rt"?(a.h=Math.round(t.h+(n.y-s.y)/o),a.w=Math.round(t.w+(s.x-n.x)/o),a.y=Math.round(t.y+(s.y-n.y)/o)):e==="r"?a.w=Math.round(t.w+(s.x-n.x)/o):e==="rb"?(a.h=Math.round(t.h+(s.y-n.y)/o),a.w=Math.round(t.w+(s.x-n.x)/o)):e==="b"?a.h=Math.round(t.h+(s.y-n.y)/o):e==="lb"?(a.h=Math.round(t.h+(s.y-n.y)/o),a.w=Math.round(t.w+(n.x-s.x)/o),a.x=Math.round(t.x+(s.x-n.x)/o)):e==="l"?(a.w=Math.round(t.w+(n.x-s.x)/o),a.x=Math.round(t.x+(s.x-n.x)/o)):e==="lt"&&(a.h=Math.round(t.h+(n.y-s.y)/o),a.w=Math.round(t.w+(n.x-s.x)/o),a.x=Math.round(t.x+(s.x-n.x)/o),a.y=Math.round(t.y+(s.y-n.y)/o))}const se=(e,t,n,s,o,a)=>{const l=T({},n.attr),r=Object.create(null);let i,c,d;if(a==="stretch"){const h={x:(l.x+l.w/2)*s,y:(l.y+l.h/2)*s};i=document.getElementById("canvas-coms").getBoundingClientRect(),c={x:e.clientX-i.left,y:e.clientY-i.top},d={x:h.x-(c.x-h.x),y:h.y-(c.y-h.y)}}const u=h=>{if(t)if(a==="normal")Ue(t,l,{x:e.clientX,y:e.clientY},{x:h.clientX,y:h.clientY},s,r);else{const g={x:h.clientX-i.left,y:h.clientY-i.top};t.length===1?Ne(t,l,c,g,d,s,r):Ze(t,l,g,d,s,r)}else r.x=l.x+Math.round((h.clientX-e.clientX)/s/o)*o,r.y=l.y+Math.round((h.clientY-e.clientY)/s/o)*o;n.attr=T(T({},n.attr),r),p.calcAlignLine(n)},y=()=>{b(document,"mousemove",u),b(document,"mouseup",y),p.hideAlignLine(n.id)};L(document,"mousemove",u),L(document,"mouseup",y)},Je=(e,t,n,s)=>{const o=p.isNormalResizeMode?"normal":"stretch";se(e,t,n,s,0,o)},Ke=(e,t,n,s)=>{se(e,null,t,n,s,null)},Qe=(e,t,n)=>{const s=t.getBoundingClientRect(),o=s.left+s.width/2,a=s.top+s.height/2,l=Math.atan2(a-e.clientY,o-e.clientX)*180/Math.PI-n.attr.deg,r=c=>{const d=Math.atan2(a-c.clientY,o-c.clientX)*180/Math.PI-l,u=Math.round(d%360);n.attr.deg=u<0?u+360:u},i=()=>{b(document,"mousemove",r),b(document,"mouseup",i)};L(document,"mousemove",r),L(document,"mouseup",i)};const Pe=E({name:"ReferLine",props:{attr:{type:Object,required:!0},scale:{type:Number,required:!0}},setup(e){const t=v(()=>({height:`${e.attr.y+60/e.scale}px`,borderLeftWidth:`${.9/e.scale}px`})),n=v(()=>({width:`${e.attr.x+60/e.scale}px`,borderTopWidth:`${.9/e.scale}px`})),s=v(()=>({fontSize:`${12/e.scale}px`,top:`-${6/e.scale}px`,left:`-${6/e.scale}px`}));return{topLineStyle:t,leftLineStyle:n,accountStyle:s}}}),et={class:"nav-line"};function tt(e,t,n,s,o,a){return w(),M("div",et,[f("div",{class:"nav-line-top",style:m(e.topLineStyle)},null,4),f("div",{class:"nav-line-left",style:m(e.leftLineStyle)},null,4),f("div",{class:"nav-line-account",style:m(e.accountStyle)},J(e.attr.x)+", "+J(e.attr.y),5)])}var nt=k(Pe,[["render",tt],["__scopeId","data-v-833481b0"]]);const ot=E({name:"DatavTransform",components:{ReferLine:nt},props:{com:{type:Object,required:!0}},setup(e){const t=ve(),n=v(()=>p.referLine),s=v(()=>p.canvas.scale),o=v(()=>({selected:e.com.selected,hided:e.com.hided,locked:e.com.locked})),a=v(()=>({top:0,left:0,width:`${e.com.attr.w}px`,height:`${e.com.attr.h}px`,transform:`translate(${e.com.attr.x}px, ${e.com.attr.y}px)`})),l=v(()=>({display:e.com.hided?"none":"block"})),r=v(()=>({hided:!e.com.selected||e.com.locked})),i=v(()=>({cursor:"move",transform:`rotate(${e.com.attr.deg}deg)`})),c=v(()=>{const{hided:x,attr:H}=e.com,z=p.pageConfig.styleFilterParams;let q="";return z.enable&&(q=`hue-rotate(${z.hue}deg) contrast(${z.contrast}%) opacity(${z.opacity}%) saturate(${z.saturate}%) brightness(${z.brightness}%)`),{display:x?"none":"block",transform:`scaleX(${H.filpH?-1:1}) scaleY(${H.filpV?-1:1}) rotateZ(360deg)`,filter:q}}),d=v(()=>({width:`${e.com.attr.w}px`,height:`${e.com.attr.h}px`})),u=v(()=>Oe(e.com.attr.deg)),y=v(()=>{const x=`scale(${1/s.value}, ${1/s.value})`;return{t:{name:"top",style:{cursor:u.value.t,transform:x}},rt:{name:"top-right",style:{cursor:u.value.rt},rotateStyle:{"transform-origin":"25% 75%",transform:x}},r:{name:"right",style:{cursor:u.value.r,transform:x}},rb:{name:"bottom-right",style:{cursor:u.value.rb},rotateStyle:{"transform-origin":"25% 25%",transform:x}},b:{name:"bottom",style:{cursor:u.value.b,transform:x}},lb:{name:"bottom-left",style:{cursor:u.value.lb},rotateStyle:{"transform-origin":"75% 25%",transform:x}},l:{name:"left",style:{cursor:u.value.l,transform:x}},lt:{name:"top-left",style:{cursor:u.value.lt},rotateStyle:{"transform-origin":"75% 75%",transform:x}}}}),h=()=>{e.com.selected||p.selectCom(e.com.id)},g=()=>{e.com.hovered=!0},C=()=>{e.com.hovered=!1},_=x=>{h(),Ke(x,e.com,s.value,p.pageConfig.grid)},ae=(x,H)=>{h(),Je(x,H,e.com,s.value)},ie=x=>{Qe(x,t.vnode.el,e.com)},{showMenu:le}=xe();return{referLine:n,scale:s,transformClass:o,transformStyle:a,hideStyle:l,handlerClass:r,handlerStyle:i,comStyle:c,wrapperStyle:d,points:y,onEnter:g,onLeave:C,onMove:_,onZoom:ae,onRotate:ie,showMenu:le}}}),st=e=>(Q("data-v-6df1a234"),e=e(),P(),e),at=["onMousedown"],it=["onMousedown"],lt=st(()=>f("div",{class:"transform-bg"},null,-1));function rt(e,t,n,s,o,a){const l=R("refer-line");return w(),M("div",{class:B(["datav-transform",e.transformClass]),style:m(e.transformStyle)},[e.referLine.enable&&e.com.selected?(w(),I(l,{key:0,attr:e.com.attr,scale:e.scale},null,8,["attr","scale"])):N("",!0),f("div",{class:B(["datav-scale",{hovered:e.com.hovered}]),style:m(e.hideStyle),onMouseenter:t[2]||(t[2]=(...r)=>e.onEnter&&e.onEnter(...r)),onMouseleave:t[3]||(t[3]=(...r)=>e.onLeave&&e.onLeave(...r)),onMousedown:t[4]||(t[4]=D((...r)=>e.onMove&&e.onMove(...r),["prevent","stop"]))},[f("div",{class:B(["transform-handler",e.handlerClass]),style:m(e.handlerStyle)},[f("div",{class:"datav-com",style:m(e.comStyle)},[me(e.$slots,"default",{},void 0,!0),f("div",{class:"datav-wrapper-event-disable",style:m(e.wrapperStyle),onContextmenu:t[0]||(t[0]=(...r)=>e.showMenu&&e.showMenu(...r))},null,36)],4),(w(!0),M(j,null,K(e.points,(r,i)=>(w(),M(j,{key:i},[r.rotateStyle?(w(),M("i",{key:0,class:B(`${r.name}-handler`),"data-html2canvas-ignore":""},[f("span",{class:"rotate-handler",style:m(r.rotateStyle),onMousedown:t[1]||(t[1]=D((...c)=>e.onRotate&&e.onRotate(...c),["prevent","stop"]))},[f("span",{class:"control-point",style:m(r.style),onMousedown:D(c=>e.onZoom(c,i),["prevent","stop"])},null,44,at)],36)],2)):(w(),M("i",{key:1,class:B(`${r.name}-handler`),"data-html2canvas-ignore":""},[f("span",{class:"control-point",style:m(r.style),onMousedown:D(c=>e.onZoom(c,i),["prevent","stop"])},null,44,it)],2))],64))),128)),lt],6)],38)],6)}var ct=k(ot,[["render",rt],["__scopeId","data-v-6df1a234"]]);const dt=E({name:"CanvasMain",components:{AlignLine:Ge,Ruler:Fe,DatavTransform:ct},setup(){const e=v(()=>p.canvas),t=v(()=>p.pageConfig),n=v(()=>p.coms),s=v(()=>({width:`${e.value.width}px`,height:`${e.value.height}px`})),o=v(()=>({position:"absolute",width:`${t.value.width}px`,height:`${t.value.height}px`,transform:`scale(${e.value.scale}) translate(0px, 0px)`,backgroundImage:`url(${t.value.bgimage})`,backgroundColor:t.value.bgcolor}));return{coms:n,screenShotStyle:s,canvasPanelStyle:o,dropToAddCom:async i=>{i.preventDefault();try{const c=i.dataTransfer.getData("text");if(c){Y.addLoading();let d=await we(c);const{scale:u}=p.canvas,y=(i.clientX-Y.getPanelOffsetLeft)/u,h=(i.clientY-Y.getPanelOffsetTop)/u;d.attr.x=Math.round(y-d.attr.w/2),d.attr.y=Math.round(h-d.attr.h/2),await p.addCom(d),p.selectCom(d.id),Y.removeLoading(),d.apis.source&&(await d.loadData(),ge(()=>{pe.datavComponents[d.id].$DATAV_requestData()}))}}catch{}},cancelSelectCom:()=>{p.selectCom()},dragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="copy"}}}}),ut=e=>(Q("data-v-57eb6e2c"),e=e(),P(),e),ht={class:"canvas-main"},ft=ut(()=>f("div",{class:"thumbnail"},null,-1));function mt(e,t,n,s,o,a){const l=R("align-line"),r=R("ruler"),i=R("datav-transform");return w(),M("div",ht,[f("div",{id:"canvas-wp",class:"canvas-panel-wrap",onMousedown:t[2]||(t[2]=D((...c)=>e.cancelSelectCom&&e.cancelSelectCom(...c),["stop"]))},[f("div",{class:"screen-shot",style:m(e.screenShotStyle)},[O(l),O(r),f("div",{id:"canvas-coms",class:"canvas-panel",style:m(e.canvasPanelStyle),onDragover:t[0]||(t[0]=(...c)=>e.dragOver&&e.dragOver(...c)),onDrop:t[1]||(t[1]=(...c)=>e.dropToAddCom&&e.dropToAddCom(...c))},[(w(!0),M(j,null,K(e.coms,c=>(w(),I(i,{key:c.id,com:c},{default:U(()=>[(w(),I(ye(c.name),{com:c,style:m({transform:"translateZ(0px)",opacity:c.attr.opacity})},null,8,["com","style"]))]),_:2},1032,["com"]))),128))],36)],4)],32),ft])}var Mt=k(dt,[["render",mt],["__scopeId","data-v-57eb6e2c"]]);export{Mt as default};
