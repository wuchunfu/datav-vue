import{a3 as V,a8 as C,bf as B,a4 as c,a5 as m,a9 as p,ac as o,aZ as d,b1 as h,aa as D,af as w,ad as A,ae as R,ag as K,b2 as j,aG as S,bi as $,aB as q,ai as G,aO as Z,aP as H,a6 as T}from"./vendor.0227b33d.js";import{b as z,E as I,a1 as L}from"./App.4d672324.js";import{I as M}from"./arrow-right.24d527ee.js";import{C as J}from"./config-title.4dbd1980.js";import{E as Q}from"./empty-panel.c18ef06c.js";import{I as W}from"./plus.73f54783.js";import{I as X}from"./delete.ef1afe75.js";import"./document.c402f011.js";const Y=V({name:"EventItem",components:{IconArrowRight:M,IconDelete:X,IconPlus:W},props:{item:{type:Object,required:!0}},setup(e){const r=C(!0),y=C(e.item.enable),v=B("addField"),l=B("deleteField"),E=B("updateField"),_=B("toggleEnable");return{visible:r,isEnabled:y,addField:()=>{v(e.item.name)},deleteField:u=>{l(e.item.name,u)},updateField:(u,n,t)=>{u[n]=t;const a=e.item.fields.filter(s=>s.name).map(s=>({name:s.name,map:s.map}));E(e.item.name,a)},onEnableChange:u=>{e.item.enable=u,_(e.item.name,u)}}}}),N={class:"event"},x={class:"event-text"},ee=j(" \u542F\u7528 "),te={key:0,class:"variables"},ne={class:"variables-table"},se=o("thead",null,[o("tr",null,[o("th",{width:"80"},[o("span",null,"\u5B57\u6BB5")]),o("th",{width:"110",style:{position:"relative"}},[o("span",null,"\u7ED1\u5B9A\u5230\u53D8\u91CF")]),o("th",{width:"110"},[o("span",null,"\u5B57\u6BB5\u8BF4\u660E")])])],-1),oe={class:"variables-tbody"},ae={class:"variable-input"},le={class:"variable-input"},ie={class:"variable-btn"},de={class:"variable-input"},ce={class:"desc"},ue={class:"add-variable"},re=j(" \u65B0\u5EFA\u4E00\u4E2A\u5B57\u6BB5 ");function me(e,r,y,v,l,E){const _=c("IconArrowRight"),f=c("n-icon"),g=c("n-checkbox"),b=c("new-input"),k=c("IconDelete"),u=c("IconPlus"),n=c("n-button");return m(),p("div",N,[o("div",{class:"events-title",onClick:r[1]||(r[1]=t=>e.visible=!e.visible)},[d(f,{class:D(e.visible?"events-down":"events-up")},{default:h(()=>[d(_)]),_:1},8,["class"]),o("div",x,w(e.item.description),1),d(g,{checked:e.isEnabled,"onUpdate:checked":[r[0]||(r[0]=t=>e.isEnabled=t),e.onEnableChange],class:"enable-checkbox"},{default:h(()=>[ee]),_:1},8,["checked","onUpdate:checked"])]),e.visible?(m(),p("div",te,[o("table",ne,[se,o("tbody",oe,[(m(!0),p(A,null,R(e.item.fields,(t,a)=>(m(),p("tr",{key:a},[t.custom?(m(),p(A,{key:0},[o("td",ae,[d(b,{"model-value":t.name,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:s=>e.updateField(t,"name",s)},null,8,["model-value","onChange"])]),o("td",le,[d(b,{"model-value":t.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:s=>e.updateField(t,"map",s)},null,8,["model-value","onChange"])]),o("td",ie,[d(f,{class:"delete-btn",onClick:s=>e.deleteField(a)},{default:h(()=>[d(k)]),_:2},1032,["onClick"])])],64)):(m(),p(A,{key:1},[o("td",null,w(t.name),1),o("td",de,[d(b,{"model-value":t.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:s=>e.updateField(t,"map",s)},null,8,["model-value","onChange"])]),o("td",ce,w(t.description),1)],64))]))),128))])]),o("div",ue,[d(n,{focusable:!1,size:"tiny",onClick:e.addField},{icon:h(()=>[d(f,{size:12},{default:h(()=>[d(u)]),_:1})]),default:h(()=>[re]),_:1},8,["onClick"])])])):K("",!0)])}var pe=z(Y,[["render",me]]);const ve=V({name:"InteractionPanel",components:{ConfigTitle:J,EmptyPanel:Q,EventItem:pe,IconArrowRight:M},setup(){const e=B("com"),r=C(!0),y=S(()=>Object.keys(e.value.events)),v=C([]);let l=C(I.variables.componentsView[e.value.id]);const E=(n,t,a,s=!1)=>({name:n,map:t||n,description:a,custom:s}),_=n=>{if(l.value||(l.value={}),!l.value[n]){const t=Object.keys(e.value.events[n].fields);l.value[n]={enable:!1,fields:L(t)}}},f=()=>{const n=[];for(const[t,a]of Object.entries(e.value.events)){const s={name:t,description:a.description,enable:!1,fields:Object.entries(a.fields).map(([i,F])=>E(i,"",F.description))};if(l.value){const i=l.value[t];if(i){s.enable=i.enable;for(const[F,O]of Object.entries(i.fields)){const P=s.fields.find(U=>U.name===F);P?P.map=O:s.fields.push(E(F,O,"",!0))}}}n.push(s)}v.value.push(...n)},g=n=>{const t=v.value.find(a=>a.name===n);t.fields.some(a=>a.name==="")||t.fields.push(E("","","",!0))},b=(n,t)=>{const s=v.value.find(i=>i.name===n).fields.splice(t,1)[0].name;if(s){delete l.value[n].fields[s];const i=l.value[n];i.enable&&I.setPublishersView({id:e.value.id,keys:Object.entries(i.fields).map(F=>F[1]||F[0]),enable:!0})}},k=(n,t)=>{_(n),l.value[n].fields=L(t,"name","map"),l.value[n].enable&&I.setPublishersView({id:e.value.id,keys:t.map(a=>a.map||a.name),enable:!0})},u=(n,t)=>{_(n);const a=l.value[n];a.enable=t;const s=[];for(const i in a.fields)t&&!a.fields[i]&&(a.fields[i]=i),s.push(a.fields[i]);I.setPublishersView({id:e.value.id,keys:s,enable:t})};return $("addField",g),$("deleteField",b),$("updateField",k),$("toggleEnable",u),q(l,()=>{I.variables.componentsView[e.value.id]=l.value}),G(()=>{f()}),{com:e,eventKeys:y,visible:r,eventList:v}}}),_e={class:"interaction-panle"},fe={key:0},be={class:"com-events"},he=o("span",null,w("\u4EA4\u4E92\u4E8B\u4EF6"),-1),Ee={class:"extra"},Fe=j("\u6559\u7A0B"),ge={class:"event-list"};function ke(e,r,y,v,l,E){const _=c("config-title"),f=c("IconArrowRight"),g=c("n-icon"),b=c("router-link"),k=c("event-item"),u=c("empty-panel");return m(),p("div",_e,[d(_,{"com-name":e.com.name,"com-alias":e.com.alias},null,8,["com-name","com-alias"]),e.eventKeys.length>0?(m(),p("div",fe,[o("div",be,[o("div",{class:"events-title",onClick:r[0]||(r[0]=n=>e.visible=!e.visible)},[d(g,{class:D(e.visible?"events-down":"events-up")},{default:h(()=>[d(f)]),_:1},8,["class"]),he,o("span",Ee,[d(b,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"tutorial-link"},{default:h(()=>[Fe]),_:1})])]),Z(o("div",ge,[(m(!0),p(A,null,R(e.eventList,n=>(m(),T(k,{key:n.name,item:n},null,8,["item"]))),128))],512),[[H,e.visible]])])])):(m(),T(u,{key:1,content:"\u8BE5\u7EC4\u4EF6\u6CA1\u6709\u4EA4\u4E92\u4E8B\u4EF6"}))])}var Oe=z(ve,[["render",ke]]);export{Oe as default};
