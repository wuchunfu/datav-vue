import{a2 as D,a7 as C,be as A,a3 as c,a4 as m,a8 as p,ab as a,aY as d,b0 as h,a9 as P,ae as I,ac as w,ad as R,af as S,b1 as j,aF as U,bh as $,aA as K,ah as q,aN as Y,aO as G,a5 as T}from"./vendor.1e2d2fe8.js";import{b as z,E as B,a3 as H,a4 as J}from"./App.341e2996.js";import{I as L}from"./arrow-right.1b66f904.js";import{C as Q}from"./config-title.dbb79c41.js";import{E as W}from"./empty-panel.49a3119c.js";import{I as X}from"./plus.a06f20f9.js";import{I as Z}from"./delete.d2d84629.js";import"./document.61510b73.js";const N=D({name:"EventItem",components:{IconArrowRight:L,IconDelete:Z,IconPlus:X},props:{item:{type:Object,required:!0}},setup(e){const r=C(!0),y=C(e.item.enable),v=A("addField"),l=A("deleteField"),E=A("updateField"),_=A("toggleEnable");return{visible:r,isEnabled:y,addField:()=>{v(e.item.name)},deleteField:u=>{l(e.item.name,u)},updateField:(u,n,t)=>{u[n]=t;const o=e.item.fields.filter(s=>s.name).map(s=>({name:s.name,map:s.map}));E(e.item.name,o)},onEnableChange:u=>{e.item.enable=u,_(e.item.name,u)}}}}),x={class:"event"},ee={class:"event-text"},te=j(" \u542F\u7528 "),ne={key:0,class:"variables"},se={class:"variables-table"},ae=a("thead",null,[a("tr",null,[a("th",{width:"80"},[a("span",null,"\u5B57\u6BB5")]),a("th",{width:"110",style:{position:"relative"}},[a("span",null,"\u7ED1\u5B9A\u5230\u53D8\u91CF")]),a("th",{width:"110"},[a("span",null,"\u5B57\u6BB5\u8BF4\u660E")])])],-1),oe={class:"variables-tbody"},le={class:"variable-input"},ie={class:"variable-input"},de={class:"variable-btn"},ce={class:"variable-input"},ue={class:"desc"},re={class:"add-variable"},me=j(" \u65B0\u5EFA\u4E00\u4E2A\u5B57\u6BB5 ");function pe(e,r,y,v,l,E){const _=c("IconArrowRight"),b=c("n-icon"),g=c("n-checkbox"),f=c("new-input"),k=c("IconDelete"),u=c("IconPlus"),n=c("n-button");return m(),p("div",x,[a("div",{class:"events-title",onClick:r[1]||(r[1]=t=>e.visible=!e.visible)},[d(b,{class:P(e.visible?"events-down":"events-up")},{default:h(()=>[d(_)]),_:1},8,["class"]),a("div",ee,I(e.item.description),1),d(g,{checked:e.isEnabled,"onUpdate:checked":[r[0]||(r[0]=t=>e.isEnabled=t),e.onEnableChange],class:"enable-checkbox"},{default:h(()=>[te]),_:1},8,["checked","onUpdate:checked"])]),e.visible?(m(),p("div",ne,[a("table",se,[ae,a("tbody",oe,[(m(!0),p(w,null,R(e.item.fields,(t,o)=>(m(),p("tr",{key:o},[t.custom?(m(),p(w,{key:0},[a("td",le,[d(f,{"model-value":t.name,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:s=>e.updateField(t,"name",s)},null,8,["model-value","onChange"])]),a("td",ie,[d(f,{"model-value":t.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:s=>e.updateField(t,"map",s)},null,8,["model-value","onChange"])]),a("td",de,[d(b,{class:"delete-btn",onClick:s=>e.deleteField(o)},{default:h(()=>[d(k)]),_:2},1032,["onClick"])])],64)):(m(),p(w,{key:1},[a("td",null,I(t.name),1),a("td",ce,[d(f,{"model-value":t.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:s=>e.updateField(t,"map",s)},null,8,["model-value","onChange"])]),a("td",ue,I(t.description),1)],64))]))),128))])]),a("div",re,[d(n,{focusable:!1,size:"tiny",onClick:e.addField},{icon:h(()=>[d(b,{size:12},{default:h(()=>[d(u)]),_:1})]),default:h(()=>[me]),_:1},8,["onClick"])])])):S("",!0)])}var ve=z(N,[["render",pe]]);const _e=D({name:"InteractionPanel",components:{ConfigTitle:Q,EmptyPanel:W,EventItem:ve,IconArrowRight:L},setup(){const e=A("com"),r=C(!0),y=U(()=>Object.keys(e.value.events)),v=C([]);let l=C(B.variables.componentsView[e.value.id]);const E=(n,t,o,s=!1)=>({name:n,map:t||n,description:o,custom:s}),_=n=>{if(l.value||(l.value={}),!l.value[n]){const t=Object.keys(e.value.events[n].fields);l.value[n]={enable:!1,fields:J(t)}}},b=()=>{const n=[];for(const[t,o]of Object.entries(e.value.events)){const s={name:t,description:o.description,enable:!1,fields:Object.entries(o.fields).map(([i,F])=>E(i,"",F.description))};if(l.value){const i=l.value[t];if(i){s.enable=i.enable;for(const[F,O]of Object.entries(i.fields)){const V=s.fields.find(M=>M.name===F);V?V.map=O:s.fields.push(E(F,O,"",!0))}}}n.push(s)}v.value.push(...n)},g=n=>{const t=v.value.find(o=>o.name===n);t.fields.some(o=>o.name==="")||t.fields.push(E("","","",!0))},f=(n,t)=>{const s=v.value.find(i=>i.name===n).fields.splice(t,1)[0].name;if(s){delete l.value[n].fields[s];const i=l.value[n];i.enable&&B.setPublishersView({id:e.value.id,keys:Object.entries(i.fields).map(F=>F[1]||F[0]),enable:!0})}},k=(n,t)=>{_(n),l.value[n].fields=H(t,"name","map"),l.value[n].enable&&B.setPublishersView({id:e.value.id,keys:t.map(o=>o.map||o.name),enable:!0})},u=(n,t)=>{_(n);const o=l.value[n];o.enable=t;const s=[];for(const i in o.fields)t&&!o.fields[i]&&(o.fields[i]=i),s.push(o.fields[i]);B.setPublishersView({id:e.value.id,keys:s,enable:t})};return $("addField",g),$("deleteField",f),$("updateField",k),$("toggleEnable",u),K(l,()=>{B.variables.componentsView[e.value.id]=l.value}),q(()=>{b()}),{com:e,eventKeys:y,visible:r,eventList:v}}}),be={class:"interaction-panle"},fe={key:0},he={class:"com-events"},Ee=a("span",null,I("\u4EA4\u4E92\u4E8B\u4EF6"),-1),Fe={class:"extra"},ge=j("\u6559\u7A0B"),ke={class:"event-list"};function ye(e,r,y,v,l,E){const _=c("config-title"),b=c("IconArrowRight"),g=c("n-icon"),f=c("router-link"),k=c("event-item"),u=c("empty-panel");return m(),p("div",be,[d(_,{"com-name":e.com.name,"com-alias":e.com.alias},null,8,["com-name","com-alias"]),e.eventKeys.length>0?(m(),p("div",fe,[a("div",he,[a("div",{class:"events-title",onClick:r[0]||(r[0]=n=>e.visible=!e.visible)},[d(g,{class:P(e.visible?"events-down":"events-up")},{default:h(()=>[d(b)]),_:1},8,["class"]),Ee,a("span",Fe,[d(f,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"tutorial-link"},{default:h(()=>[ge]),_:1})])]),Y(a("div",ke,[(m(!0),p(w,null,R(e.eventList,n=>(m(),T(k,{key:n.name,item:n},null,8,["item"]))),128))],512),[[G,e.visible]])])])):(m(),T(u,{key:1,content:"\u8BE5\u7EC4\u4EF6\u6CA1\u6709\u4EA4\u4E92\u4E8B\u4EF6"}))])}var Ve=z(_e,[["render",ye]]);export{Ve as default};
