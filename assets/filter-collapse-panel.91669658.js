import{b as R}from"./App.2074c692.js";import{I as J}from"./arrow-left.1ade43d2.js";import{I as K}from"./edit.bc80ca49.js";import{I as Q}from"./delete.490b613d.js";import{I as X}from"./release.d11cb5a8.js";import{a5 as n,a9 as d,ac as t,a3 as Y,b2 as x,a8 as u,bh as p,aG as S,a4 as l,ad as z,aZ as o,b3 as s,ag as k,a6 as m,af as h,b4 as C,aa as U}from"./vendor.60e09344.js";const ee={},te={t:"1632575311693",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3931",width:"64",height:"64"},ae=t("path",{d:"M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3932"},null,-1),ne=t("path",{d:"M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3933"},null,-1),oe=t("path",{d:"M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3934"},null,-1),se=t("path",{d:"M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3935"},null,-1),le=t("path",{d:"M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3936"},null,-1),ie=t("path",{d:"M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3937"},null,-1),de=[ae,ne,oe,se,le,ie];function re(e,i){return n(),d("svg",te,de)}var ce=R(ee,[["render",re]]);const ue={},pe={t:"1639131683779",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3989",width:"64",height:"64"},ge=t("path",{d:"M832.990625 494.253125","p-id":"3990"},null,-1),fe=t("path",{d:"M567.659375 510.678125L894.134375 185.6375c15.440625-15.384375 15.525-40.275 0.16875-55.74375-15.384375-15.496875-40.246875-15.525-55.6875-0.16875L512.028125 454.821875 188.309375 129.865625C173.009375 114.48125 148.0625 114.425 132.65 129.78125 117.2375 145.165625 117.209375 170.1125 132.565625 185.553125l323.634375 324.871875L129.865625 835.26875c-15.440625 15.384375-15.525 40.275-0.16875 55.74375 7.678125 7.734375 17.803125 11.615625 27.928125 11.615625 10.040625 0 20.08125-3.825 27.759375-11.475l326.390625-324.928125 326.671875 327.909375C846.153125 901.896875 856.25 905.75 866.346875 905.75c10.06875 0 20.1375-3.853125 27.815625-11.503125 15.384375-15.384375 15.440625-40.275 0.084375-55.715625L567.659375 510.678125 567.659375 510.678125zM567.659375 510.678125","p-id":"3991"},null,-1),me=[ge,fe];function he(e,i){return n(),d("svg",pe,me)}var ve=R(ue,[["render",he]]);const _e=Y({name:"FilterCollapsePanel",components:{IconArrowLeft:J,IconEdit:K,IconRelease:X,IconDelete:Q,IconDrag:ce,IconClose:ve},props:{dataFilter:{type:Object,required:!0},draggable:{type:Boolean,default:!0},hasFeedback:{type:Boolean,default:!0},removable:Boolean,publish:Boolean,isNew:Boolean,index:Number,showTime:Boolean},setup(e){const i=x(),E=u(null),$=u(e.isNew),v=u(e.isNew),N=u(e.isNew),c=u(e.isNew),r=u(!1),g=u(e.dataFilter.origin),F=p("dataStatus",null),M=S(()=>{let a="";const w=F==null?void 0:F.value.filter;return w&&w[e.dataFilter.id]&&(a=w[e.dataFilter.id]),a}),b=p("usedFilters"),_=p("enabledFilters",null),D=p("onUsedChange",null),j=p("editFilterName"),y=p("removeFilter"),A=p("saveFilter"),B=p("updateIndicator",null),L=S(()=>{var a;return(a=_==null?void 0:_.value[e.dataFilter.id])!=null?a:!1}),I=a=>{D(e.dataFilter.id,a)},T=a=>{$.value=!1,j(a,e.dataFilter)},f=a=>{a.value!=e.dataFilter.origin&&(c.value=!0)},V=a=>{g.value=a.value},q=()=>{e.isNew?y(0):(g.value=e.dataFilter.origin,c.value?c.value=!1:v.value=!1)},H=async()=>{if(!c.value){v.value=!1;return}try{r.value=!0,e.dataFilter.origin=g.value,e.dataFilter.code=`
          if (!data) {  return data; }
          return filter(...arguments);
          function filter(data) {
            ${g.value}
            return data;
          }
        `,await A(e.dataFilter),c.value=!1,i.success("\u6570\u636E\u8FC7\u6EE4\u5668\u5DF2\u4FDD\u5B58")}catch(a){i.error(a.message)}finally{r.value=!1}},O=()=>{N.value=!0,v.value=!v.value},P=a=>{const w=a.target.parentNode.parentNode.parentNode.parentElement,Z=document.querySelector(".filter-dragging-wp");Z.innerHTML="",Z.appendChild(w.cloneNode(!0)),a.dataTransfer.setDragImage(Z,30,15)},W=()=>{const a=document.querySelector(".filter-dragging-wp");a.innerHTML="",B(!1,e.index,E.value)},G=()=>{B(!0,e.index,E.value)};return{panelRef:E,code:g,loading:r,editing:$,collapse:v,isOpened:N,isEdited:c,isEnabled:L,usedFilters:b,errMsg:M,loading2:u(!1),switchEnabled:I,editName:T,removeFilter:y,changeCode:f,updateCode:V,cancelEdit:q,saveData:H,toggleEditor:O,dragStart:P,dragEnd:W,dragEnter:G}}}),Fe={class:"panel-header"},be={class:"panel-title"},we={class:"filter-title"},ke={class:"filter-name"},Ce=["title"],Ee={class:"action-wp --edit"},De={class:"filter-count"},ye=t("div",{class:"filter-dot"},null,-1),Be={key:1,class:"filter-dot"},Ie={key:2,class:"filter-dot --none"},$e={class:"panel-content-wp"},Ne={class:"cp-wrap"},Me=t("p",{title:"function filter(data) {",class:"fake-code --start"},[t("span",{class:"--keyword"},"function"),C(" filter(data) { ")],-1),je=t("p",{class:"fake-code --end"},"}",-1),Ae={class:"filter-actions"},Le={key:0,class:"unsaved"},Te={key:1,class:"saved"};function Ze(e,i,E,$,v,N){const c=l("IconDrag"),r=l("n-icon"),g=l("n-checkbox"),F=l("new-input"),M=l("IconEdit"),b=l("g-tooltip-popover"),_=l("n-tooltip"),D=l("n-config-provider"),j=l("IconRelease"),y=l("IconDelete"),A=l("IconClose"),B=l("IconArrowLeft"),L=l("g-monaco-editor"),I=l("n-button"),T=l("n-collapse-transition");return n(),d("div",{ref:"panelRef",class:U(["collapse-panel-wp filter-item ds-panel-filter",{"--create":e.isNew,"--spread":e.collapse||e.isNew,"--draggable":e.draggable,"--unused":e.hasFeedback&&!e.isEnabled,"--error":!!e.errMsg}]),onDragenter:i[3]||(i[3]=(...f)=>e.dragEnter&&e.dragEnter(...f))},[t("div",Fe,[t("div",be,[t("div",we,[e.draggable?(n(),d(z,{key:0},[o(r,{draggable:"true",class:"drag-btn",onDragstart:e.dragStart,onDragend:e.dragEnd},{default:s(()=>[o(c)]),_:1},8,["onDragstart","onDragend"]),o(g,{checked:e.isEnabled,class:"enable-checkbox","onUpdate:checked":e.switchEnabled},null,8,["checked","onUpdate:checked"])],64)):k("",!0),t("div",ke,[e.editing?(n(),m(F,{key:0,"model-value":e.dataFilter.name,autofocus:!0,class:"filter-name-input",onChange:e.editName},null,8,["model-value","onChange"])):(n(),d("div",{key:1,class:"filter-name-text",title:e.dataFilter.name},h(e.dataFilter.name),9,Ce))]),t("div",Ee,[o(b,{content:"\u91CD\u547D\u540D"},{default:s(()=>[o(r,{class:"edit-btn",onClick:i[0]||(i[0]=f=>e.editing=!0)},{default:s(()=>[o(M)]),_:1})]),_:1})]),t("div",De,[!e.isNew&&e.usedFilters[e.dataFilter.id]?(n(),m(D,{key:0,"theme-overrides":{Tooltip:{arrowHeight:"8px",borderRadius:"2px",padding:"6px",color:"var(--datav-font-color)",textColor:"#000102"}},abstract:""},{default:s(()=>[o(_,{placement:"top",delay:500,style:{maxWidth:"240px"}},{trigger:s(()=>[t("span",null,h(e.usedFilters[e.dataFilter.id].names.length)+" \u4E2A\u7EC4\u4EF6\u6B63\u5728\u8C03\u7528",1)]),default:s(()=>[C(" "+h(e.usedFilters[e.dataFilter.id].names.join(", ")),1)]),_:1})]),_:1},8,["theme-overrides"])):k("",!0)]),t("div",{class:U(["action-wp",{"--flex":e.publish}])},[e.publish?(n(),m(b,{key:0,content:"\u521B\u5EFA\u4EE3\u7801\u7247\u6BB5"},{default:s(()=>[o(r,{class:"save-btn"},{default:s(()=>[o(j)]),_:1})]),_:1})):k("",!0),o(b,{content:"\u5220\u9664"},{default:s(()=>[o(r,{class:"del-btn",onClick:i[1]||(i[1]=f=>e.removeFilter(e.dataFilter.id))},{default:s(()=>[e.removable?(n(),m(y,{key:0})):(n(),m(A,{key:1}))]),_:1})]),_:1})],2),e.hasFeedback?(n(),d(z,{key:1},[e.errMsg?(n(),m(D,{key:0,"theme-overrides":{Tooltip:{color:"var(--datav-error-color)"}},abstract:""},{default:s(()=>[o(_,{placement:"left",style:{maxWidth:"300px"}},{trigger:s(()=>[ye]),default:s(()=>[C(" "+h(e.errMsg),1)]),_:1})]),_:1},8,["theme-overrides"])):(n(),d("div",Be))],64)):(n(),d("div",Ie))])]),t("div",{class:"toggle-btn",onClick:i[2]||(i[2]=(...f)=>e.toggleEditor&&e.toggleEditor(...f))},[o(r,{class:"toggle-icon"},{default:s(()=>[o(B)]),_:1})])]),e.isOpened?(n(),m(T,{key:0,show:e.collapse},{default:s(()=>[t("div",$e,[t("div",Ne,[Me,o(L,{language:"javascript",code:e.code,height:180,"editor-class":"filter-editor",onChange:e.changeCode,onBlur:e.updateCode},null,8,["code","onChange","onBlur"]),je,t("div",Ae,[e.isEdited?(n(),d("div",Le,"\u672A\u4FDD\u5B58")):e.showTime?(n(),d("div",Te,"\u4E0A\u6B21\u4FDD\u5B58: "+h(e.dataFilter.updateAt),1)):k("",!0),o(I,{size:"tiny",focusable:!1,class:"bolder-btn",onClick:e.cancelEdit},{default:s(()=>[C(h(e.dataFilter.id===0?"\u53D6\u6D88":e.isEdited?"\u64A4\u9500":"\u53D6\u6D88"),1)]),_:1},8,["onClick"]),o(I,{type:"primary",size:"tiny",loading:e.loading,focusable:!1,class:"bolder-btn",onClick:e.saveData},{default:s(()=>[C(h(e.dataFilter.id===0||e.isEdited?"\u4FDD\u5B58":"\u5B8C\u6210"),1)]),_:1},8,["loading","onClick"])])])])]),_:1},8,["show"])):k("",!0)],34)}var He=R(_e,[["render",Ze]]);export{He as F};
